# 分布式 id 生成器 ---snowflake/sonyflake

数值是 64 位:int64 类型，被划分为四部分，<br>
**1位bit(符号位)+41位时间戳（毫秒）+5位数据中心id+5位机器id+12位循环自增id(到达 1111 1111 1111 后会归 0)<br>**
```text
+--------------------------------------------------------------------------+
| 1 Bit Unused | 41 Bit Timestamp |  10 Bit NodeID  |   12 Bit Sequence ID |
+--------------------------------------------------------------------------+
                                                                 datacenter_id          sequence_id
      unused
                                                                       │                     │
       │                                                               │                     │
       │                                                               │                     │
       │  │                                                      │     │                     │
       │  │                                                      │     │                     │
       ▼  │◀──────────────────    41 bits   ────────────────────▶│   ▼                     ▼
    ┌─────┼──────────────────────────────────────────────────────┼────────┬────────┬────────────────┐
    │  0  │ 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0  │ 00000  │ 00000  │ 0000 0000 0000 │
    └─────┴──────────────────────────────────────────────────────┴────────┴────────┴────────────────┘
                                      ▲                                        ▲
                                      │                                        │
                                      │                                        │
                                      │                                        │
                                      │                                        │
                                      │                                        │
                                      │                                        │
                            time in milliseconds 毫秒                       worker_id

```
```text
不含开头的第一个 bit，因为这个 bit 是符号位。
用 41 位来表示收到请求时的时间戳，单位为毫秒，
然后五位来表示数据中心的 id，
然后再五位来表示机器的实例 id，
最后是 12 位的循环自增 id(到达 1111 1111 1111 后会归 0)。

这样的机制可以支持我们在同一台机器上，同一毫秒内产生 2 ^ 12 = 4096 条消息。一秒共 409.6w 条消息。
数据中心 + 实例 id 共有 10 位，可以支持我们每数据中心部署 32 台机器，所有数据中心共 1024 台实例。
表示 timestamp 的 41 位，可以支持我们使用 69 年。
```

### 1. 标准 snowflake 实现
```text
github.com/bwmarrin/snowflake 是一个相当轻量化的 snowflake 的 Go 实现。和标准的 snowflake 完全一致。
+--------------------------------------------------------------------------+
| 1 Bit Unused | 41 Bit Timestamp |  10 Bit NodeID  |   12 Bit Sequence ID |
+--------------------------------------------------------------------------+
```

###2. sonyflake
```text
sonyflake 是 Sony 公司的一个开源项目，基本思路和 snowflake 差不多，不过位分配上稍有不同：
+-----------------------------------------------------------------------------+
| 1 Bit Unused | 39 Bit Timestamp |  8 Bit Sequence ID  |   16 Bit Machine ID |
+-----------------------------------------------------------------------------+

``` 

